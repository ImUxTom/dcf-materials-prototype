{# _includes/task/main-tabs.njk #}

<<<<<<< HEAD


=======
>>>>>>> upstream/main
{# -----------------------------
   Tasks tab content
   ----------------------------- #}

{% set tasksHtml %}

  {# Filters row under the tabs #}
  <div class="govuk-grid-row govuk-!-margin-bottom-4 app-task-filters">
    <div class="govuk-grid-column-one-quarter">
      {{ govukSelect({
        id: "filter-urn-or-defendant",
        name: "filter-urn-or-defendant",
        label: {
          text: "URN or defendant surname"
        },
        items: [
          { value: "", text: "All", selected: true },
          { value: "urn-1", text: "Example URN 1" },
          { value: "urn-2", text: "Example URN 2" }
        ]
      }) }}
    </div>

    <div class="govuk-grid-column-one-quarter">
      {{ govukSelect({
        id: "filter-unit-group",
        name: "filter-unit-group",
        label: {
          text: "Unit group"
        },
        items: [
          { value: "", text: "All unit groups", selected: true },
          { value: "group-a", text: "Group A" },
          { value: "group-b", text: "Group B" }
        ]
      }) }}
    </div>

    <div class="govuk-grid-column-one-quarter">
      {{ govukSelect({
        id: "filter-unit",
        name: "filter-unit",
        label: {
          text: "Unit"
        },
        items: [
          { value: "", text: "All units", selected: true },
          { value: "unit-1", text: "Unit 1" },
          { value: "unit-2", text: "Unit 2" }
        ]
      }) }}
    </div>

    <div class="govuk-grid-column-one-quarter">
      {{ govukSelect({
        id: "filter-owner",
        name: "filter-owner",
        label: {
          text: "Owner"
        },
        items: [
          { value: "", text: "All owners", selected: true },
          { value: "me", text: "Me" },
          { value: "my-team", text: "My team" }
        ]
      }) }}
    </div>
  </div>

  {# Task list beneath filters #}
  {% if tasks.length %}
    <div class="app-list">
      {% for task in tasks %}
<<<<<<< HEAD
        {# Show group heading when group changes or on first task #}
        {# {% if loop.first or task.groupKey != tasks[loop.index0 - 1].groupKey %}
          <h2 class="govuk-heading-m govuk-!-margin-top-7 govuk-!-margin-bottom-0">{{task.groupHeading}}</h2>
        {% endif %}  #}
=======
        {# Show group heading when group changes or on first task
        {% if loop.first or task.groupKey != tasks[loop.index0 - 1].groupKey %}
          <h2 class="govuk-heading-m govuk-!-margin-top-7 govuk-!-margin-bottom-0">{{task.groupHeading}}</h2>
        {% endif %} #}
>>>>>>> upstream/main

        <div class="app-list__item">
          {% set taskNameDisplay %}
            {% if task.name.length > 115 %}
              {{ task.name | truncate(115) }}
            {% else %}
              {{ task.name }}
            {% endif %}
          {% endset %}

      

            <div class="app-list__tag">
              {# {{ govukTag({ text: task.severity, classes: task.severity | severityTagClass })}} #}
<<<<<<< HEAD
              {# {% if task.isUrgent %}
                {{ govukTag({ text: 'Urgent', classes: 'govuk-tag--red govuk-!-margin-left-' })}}
              {% endif %} #}
            </div>
          
=======
              {% if task.isUrgent %}
                {{ govukTag({ text: 'Urgent', classes: 'govuk-tag--red govuk-!-margin-left-' })}}
              {% endif %}
            </div>
          </h3>
>>>>>>> upstream/main

          {% set defendantsValue %}
            {{task.case.defendants[0].firstName}} {{task.case.defendants[0].lastName}}
            {% if task.case.defendants.length > 1 %}
              and {{task.case.defendants.length - 1}} more
            {% endif %}
          {% endset %}

          {% set ownerValue %}
            {% if task.assignedToUser %}
              {{task.assignedToUser.firstName}} {{task.assignedToUser.lastName}}
            {% elif task.assignedToTeam %}
              {{task.assignedToTeam.name}} ({{task.assignedToTeam.unit.name}})
            {% endif %}
          {% endset %}

          {% set dueDateValue %}
            {{ task.dueDate | isoDateString | govukDateTime }}
            {% if task.severity == 'Overdue' or task.severity == 'Critically overdue' %}
              ({{ task.severity | lower }})
            {% else %}
              ({{ task.dueDate | daysUntil }})
            {% endif %}
          {% endset %}

<<<<<<< HEAD
          {# -----------------------------
            Wrap the case reference in a link
            ----------------------------- #}
          {% set caseRefLink %}
            <a href="/cases/{{ task.case.id }}/details"
              class="govuk-link govuk-link--no-visited-state">
              {{ task.case.reference }}
            </a>
          {% endset %}

=======
>>>>>>> upstream/main
          {{ govukSummaryList({
            classes: 'govuk-summary-list--no-border app-summary-list--compact app-summary-list--small-text',
            rows: [
              {
<<<<<<< HEAD
                key:   { text: 'Case reference number' },
                value: { html: caseRefLink }
              },
              {
                key:   { text: 'Defendant' },
                value: { html: defendantsValue }
              },
              {
                key:   { text: 'Due date' },
                value: { html: dueDateValue }
              }
            ]
          }) }}


=======
                key: { text: 'Case reference number' },
                value: { html: task.case.reference }
              },
              {
                key: { text: 'Defendant' },
                value: { html: defendantsValue }
              },
              {
                key: { text: 'Reminder date' },
                value: { html: (task.reminderDate | isoDateString | govukDateTime) }
              } if 1==2,
              {
                key: { text: 'Due date' },
                value: { html: dueDateValue }
              },
              {
                key: { text: 'Escalation date' },
                value: { html: (task.escalationDate | isoDateString | govukDateTime) }
              } if 1==2,
              {
                key: { text: 'Custody time limit' },
                value: {
                  html: (task.case.custodyTimeLimit | isoDateString | govukDateTime)
                    + ' (' + (task.case.custodyTimeLimit | daysUntil) + ')'
                }
              } if task.case.custodyTimeLimit,
              {
                key: { text: 'Statutory time limit' },
                value: {
                  html: (task.case.statutoryTimeLimit | isoDateString | govukDateTime)
                    + ' (' + (task.case.statutoryTimeLimit | daysUntil) + ')'
                }
              } if task.case.statutoryTimeLimit,
              {
                key: { text: 'PACE time limit' },
                value: {
                  html: (task.case.paceTimeLimit | isoDateString | govukDateTime)
                    + ' (' + (task.case.paceTimeLimit | daysUntil) + ')'
                }
              } if task.case.paceTimeLimit,
              {
                key: { text: 'Reason for marking as urgent' },
                value: { text: task.urgentNote }
              } if task.isUrgent,
              {
                key: { html: 'Owner' },
                value: { html: ownerValue }
              },
              {
                key: { html: 'Unit' },
                value: { html: task.case.unit.name }
              },
              {
                key: { html: 'Reminder type' },
                value: {
                  html: 'Reminder' if task.reminderType == 'Standard'
                    else 'Reminder (asset recovery)'
                }
              } if task.reminderType,
              {
                key: { html: 'Latest note' },
                value: { html: task.notes[0].description }
              } if task.notes and task.notes.length > 0,
              {
                key: { html: 'Hearing' },
                value: {
                  html: (task.case.hearings[0].startDate | isoDateString | govukDateTime)
                    + ' - ' + task.case.hearings[0].type
                }
              } if task.case.hearings and task.case.hearings.length > 0
            ]
          })}}
>>>>>>> upstream/main
        </div>
      {% endfor %}
    </div>
  {% else %}
    <p>There are no results.</p>
  {% endif %}
{% endset -%}

{# -----------------------------
   Other tabs (stubs for now)
   ----------------------------- #}
{% set priorityChangingHtml %}
  <h3 class="govuk-heading-m">Priority changing</h3>
{% endset -%}

{% set directionsHtml %}
  <h3 class="govuk-heading-m">Directions</h3>
{% endset -%}

{% set savedHtml %}
  <h3 class="govuk-heading-m">Saved</h3>
{% endset -%}

{% set manageTasksHtml %}
  <h3 class="govuk-heading-m">Manage tasks</h3>
{% endset -%}

{{ govukTabs({
  id: "task-tabs",
  items: [
    { label: "Tasks",             id: "tasks",             panel: { html: tasksHtml } },
    { label: "Priority changing", id: "priority-changing", panel: { html: priorityChangingHtml } },
    { label: "Directions",        id: "directions",        panel: { html: directionsHtml } },
    { label: "Saved",             id: "saved",             panel: { html: savedHtml } },
    { label: "Manage tasks",      id: "manage-tasks",      panel: { html: manageTasksHtml } }
  ]
}) }}
